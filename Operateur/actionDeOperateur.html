<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulaire de Transcription de Mariage</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .form-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            padding: 30px;
            margin: 30px auto;
            max-width: 1600px;
        }
        
        .header-section {
            background: linear-gradient(135deg, #fff3e0, #ffecb3);
            color: #e65100;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 5px solid #ff9800;
        }
        
        .section-title {
            color: #ff9800;
            border-bottom: 2px solid #ffecb3;
            padding-bottom: 10px;
            margin: 25px 0 15px 0;
            font-weight: 600;
        }
        
        .form-label {
            font-weight: 500;
            color: #495057;
            margin-bottom: 5px;
        }
        
        .verify-btn {
            background: linear-gradient(135deg, #ff9800, #ff5722);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 10px;
            width: 100%;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3);
            margin-top: 20px;
        }
        
        .verify-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 152, 0, 0.4);
        }
        
        .spouse-section {
            background-color: #fff3e0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid #ffcc80;
        }
        
        .verification-section {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            border: 2px solid #e9ecef;
            display: none; /* Caché par défaut */
        }
        
        .loading-section {
            background-color: #fff3e0;
            border-radius: 10px;
            padding: 40px 20px;
            margin-bottom: 25px;
            text-align: center;
            border: 2px dashed #ff9800;
        }
        
        .result-section {
            background-color: #e8f4fd;
            border-radius: 10px;
            padding: 25px;
            margin-top: 30px;
            display: none;
        }
        
        .result-item {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .result-label {
            font-weight: 600;
            color: #2c3e50;
            display: inline-block;
            width: 250px;
        }
        
        .result-value {
            color: #34495e;
        }
        
        .required::after {
            content: " *";
            color: #dc3545;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .btn-approve {
            background: linear-gradient(135deg, #4caf50, #2e7d32);
            border: none;
            padding: 12px 30px;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.2);
        }
        
        .btn-refuse {
            background: linear-gradient(135deg, #f44336, #c62828);
            border: none;
            padding: 12px 30px;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(244, 67, 54, 0.2);
        }
        
        .btn-approve:hover, .btn-refuse:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .btn-approve, .btn-refuse {
            font-size: 1.1rem;
            border-radius: 10px;
        }
        
        .verification-icon {
            font-size: 4rem;
            color: #ff9800;
            margin-bottom: 20px;
        }
        
        .btn-back {
            background: linear-gradient(135deg, #ff9800, #f57c00);
            color: white;
            border: none;
            padding: 8px 20px;
            font-weight: 500;
            border-radius: 8px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        
        .btn-back:hover {
            background: linear-gradient(135deg, #f57c00, #e65100);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        .api-data-field {
            background-color: #fff3e0;
            border: 1px solid #ffcc80;
            border-radius: 0.375rem;
            padding: 0.375rem 0.75rem;
            min-height: 38px;
            display: flex;
            align-items: center;
            color: #5d4037;
            font-weight: 500;
        }
        
        .verification-header {
            background: linear-gradient(135deg, #fff3e0, #ffecb3);
            color: #e65100;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            border: 1px solid #ffb74d;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #ffcc80;
            border-top: 5px solid #ff9800;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .form-container {
                padding: 15px;
                margin: 10px;
            }
            
            .result-label {
                width: 100%;
                margin-bottom: 5px;
            }

            #actionButtons .d-flex {
                flex-direction: column;
            }

            .btn-approve, .btn-refuse {
                width: 100%;
                min-width: 100% !important;
            }
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="form-container">
            <!-- Bouton de retour -->
            <div class="mb-4">
                <button class="btn btn-back" onclick="goBackToList()">
                    <i class="bi bi-arrow-left me-2"></i>Retour
                </button>
            </div>
            
            <!-- Header Section -->
            <div class="header-section text-center">
                <h1 class="mb-3" id="formTitle"><i class="bi bi-clipboard-data me-2"></i>Formulaire CNI</h1>
                <p class="mb-0" id="formDescription">Vérification des documents et informations du demandeur</p>
            </div>
            
            <div class="row">
                <!-- ============================================= -->
                <!-- PARTIE GAUCHE : FORMULAIRE UTILISATEUR -->
                <!-- ============================================= -->
                <div class="col-lg-6">
                    <div class="verification-header">
                        <h4><i class="bi bi-person-check me-2"></i>Données Soumises par l'Utilisateur</h4>
                        <p class="mb-0">Informations fournies par le demandeur</p>
                    </div>

                    <!-- Informations Personnelles CNI -->
                    <h3 class="section-title"><i class="bi bi-person-fill me-2"></i>Informations Personnelles</h3>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Prénoms :</label>
                            <input type="text" class="form-control" id="firstName" value="Jean-Baptiste" readonly>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Nom de famille :</label>
                            <input type="text" class="form-control" id="lastName" value="KOUAME" readonly>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Sexe :</label>
                            <input type="text" class="form-control" id="gender" value="Masculin" readonly>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Date de naissance :</label>
                            <input type="text" class="form-control" id="birthDate" value="1990-05-15" readonly>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Lieu de naissance :</label>
                            <input type="text" class="form-control" id="birthPlace" value="Abidjan" readonly>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Nationalité :</label>
                            <input type="text" class="form-control" id="nationality" value="Ivoirienne" readonly>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Situation matrimoniale :</label>
                            <input type="text" class="form-control" id="maritalStatus" value="Célibataire" readonly>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Profession :</label>
                            <input type="text" class="form-control" id="profession" value="Ingénieur Informatique" readonly>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">N° NNI :</label>
                            <input type="text" class="form-control" id="nni" value="12345678901" readonly>
                            <small class="text-muted">11 chiffres</small>
                        </div>
                    </div>

                    <!-- Filiation -->
                    <h5 class="mt-3 mb-3" style="color: #666;"><i class="bi bi-people me-2"></i>Filiation</h5>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Nom du père :</label>
                            <input type="text" class="form-control" id="fatherLastName" value="KOUAME" readonly>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Prénoms du père :</label>
                            <input type="text" class="form-control" id="fatherFirstName" value="Pierre" readonly>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Nom de jeune fille de la mère :</label>
                            <input type="text" class="form-control" id="motherMaidenName" value="BAMBA" readonly>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Prénoms de la mère :</label>
                            <input type="text" class="form-control" id="motherFirstName" value="Marie" readonly>
                        </div>
                    </div>
                    
                    <!-- Traitement et Livraison -->
                    <h3 class="section-title mt-4"><i class="bi bi-speedometer2 me-2"></i>Traitement et Livraison</h3>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Rapidité :</label>
                            <input type="text" class="form-control" id="processingSpeed" value="Normal (7 jours)" readonly>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Méthode de livraison :</label>
                            <input type="text" class="form-control" id="deliveryMethod" value="Retrait sur place" readonly>
                        </div>
                    </div>

                    <!-- Documents Soumis (Vue uniquement) -->
                    <h3 class="section-title mt-4"><i class="bi bi-file-earmark-text me-2"></i>Documents Soumis</h3>
                    <div class="documents-view-only">
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle me-2"></i>Documents soumis par l'utilisateur
                        </div>
                        <div class="list-group mb-4">
                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                <span><i class="bi bi-file-pdf text-danger me-2"></i>Acte de naissance.pdf</span>
                                <button class="btn btn-sm btn-outline-primary" onclick="showDocumentViewer()">
                                    <i class="bi bi-eye"></i> Voir
                                </button>
                            </div>
                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                <span><i class="bi bi-file-pdf text-danger me-2"></i>Certificat de nationalité.pdf</span>
                                <button class="btn btn-sm btn-outline-primary" onclick="showDocumentViewer()">
                                    <i class="bi bi-eye"></i> Voir
                                </button>
                            </div>
                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                <span><i class="bi bi-file-image text-primary me-2"></i>Photo d'identité.jpg</span>
                                <button class="btn btn-sm btn-outline-primary" onclick="showDocumentViewer()">
                                    <i class="bi bi-eye"></i> Voir
                                </button>
                            </div>
                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                <span><i class="bi bi-file-pdf text-danger me-2"></i>Justificatif de profession.pdf</span>
                                <button class="btn btn-sm btn-outline-primary" onclick="showDocumentViewer()">
                                    <i class="bi bi-eye"></i> Voir
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- OLD SECTION REMOVED -->
                    <div class="spouse-section" style="display:none;">
                        <h4 class="section-title" style="color: #f57c00;"><i class="bi bi-person me-2"></i>Époux(se) 1</h4>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label required">Prénom(s) :</label>
                                <input type="text" class="form-control" id="spouse1FirstName" placeholder="Ex: Abraham">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label required">Nom :</label>
                                <input type="text" class="form-control" id="spouse1LastName" placeholder="Ex: Diabi">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label required">Date de Naissance :</label>
                                <input type="date" class="form-control" id="spouse1BirthDate">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label required">Pays de Naissance :</label>
                                <select class="form-select" id="spouse1BirthCountry">
                                    <option value="">Sélectionnez...</option>
                                    <option value="CI">Côte d'Ivoire (CI)</option>
                                    <option value="FR">France (FR)</option>
                                    <option value="US">États-Unis (US)</option>
                                    <option value="MR">Mauritanie (MR)</option>
                                    <option value="SN">Sénégal (SN)</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label required">État/Région :</label>
                                <input type="text" class="form-control" id="spouse1State" placeholder="Ex: AB">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label required">Profession :</label>
                                <input type="text" class="form-control" id="spouse1Profession" placeholder="Ex: Business owner">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label required">Adresse :</label>
                                <input type="text" class="form-control" id="spouse1Address" placeholder="Ex: 01 BP v 240">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label required">Ville :</label>
                                <input type="text" class="form-control" id="spouse1City" placeholder="Ex: Abidjan">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label required">Code Postal :</label>
                                <input type="text" class="form-control" id="spouse1ZipCode" placeholder="Ex: 01">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label required">Téléphone :</label>
                                <input type="tel" class="form-control" id="spouse1Phone" placeholder="Ex: 469-494-9389">
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label required">E-mail :</label>
                                <input type="email" class="form-control" id="spouse1Email" placeholder="Ex: abrah25@hotmail.com">
                            </div>
                        </div>
                        
                        <!-- Filiation Époux 1 -->
                        <h5 class="mt-4 mb-3" style="color: #666;"><i class="bi bi-people me-2"></i>Filiation</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label required">Nom du Père :</label>
                                <input type="text" class="form-control" id="spouse1FatherName" placeholder="Ex: Karamokoba Diabi">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label required">Nom de la Mère :</label>
                                <input type="text" class="form-control" id="spouse1MotherName" placeholder="Ex: Binta Soumouny">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Époux(se) 2 - HIDDEN FOR CNI -->
                    <div class="spouse-section" style="display:none;">
                        <h4 class="section-title" style="color: #f57c00;"><i class="bi bi-person me-2"></i>Époux(se) 2</h4>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label required">Prénom(s) :</label>
                                <input type="text" class="form-control" id="spouse2FirstName" placeholder="Ex: Maimouna">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label required">Nom :</label>
                                <input type="text" class="form-control" id="spouse2LastName" placeholder="Ex: Sow">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label required">Date de Naissance :</label>
                                <input type="date" class="form-control" id="spouse2BirthDate">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label required">Pays de Naissance :</label>
                                <select class="form-select" id="spouse2BirthCountry">
                                    <option value="">Sélectionnez...</option>
                                    <option value="CI">Côte d'Ivoire (CI)</option>
                                    <option value="FR">France (FR)</option>
                                    <option value="US">États-Unis (US)</option>
                                    <option value="MR">Mauritanie (MR)</option>
                                    <option value="SN">Sénégal (SN)</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label required">État/Région :</label>
                                <input type="text" class="form-control" id="spouse2State" placeholder="Ex: 06">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label required">Profession :</label>
                                <input type="text" class="form-control" id="spouse2Profession" placeholder="Ex: Nurse">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label required">Adresse :</label>
                                <input type="text" class="form-control" id="spouse2Address" placeholder="Ex: 424">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label required">Ville :</label>
                                <input type="text" class="form-control" id="spouse2City" placeholder="Ex: Rosso">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label required">Code Postal :</label>
                                <input type="text" class="form-control" id="spouse2ZipCode" placeholder="Ex: 320">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label required">Téléphone :</label>
                                <input type="tel" class="form-control" id="spouse2Phone" placeholder="Ex: 4695546744">
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label required">E-mail :</label>
                                <input type="email" class="form-control" id="spouse2Email" placeholder="Ex: mamaisow@yahoo.com">
                            </div>
                        </div>
                        
                        <!-- Filiation Époux 2 -->
                        <h5 class="mt-4 mb-3" style="color: #666;"><i class="bi bi-people me-2"></i>Filiation</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label required">Nom du Père :</label>
                                <input type="text" class="form-control" id="spouse2FatherName" placeholder="Ex: Moustapha Sow">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label required">Nom de la Mère :</label>
                                <input type="text" class="form-control" id="spouse2MotherName" placeholder="Ex: Thille Sy">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Lieu de Mariage -->
                    <h3 class="section-title"><i class="bi bi-geo-alt me-2"></i>Lieu de Mariage</h3>
                    <div class="row">
                        <div class="col-12 mb-3">
                            <label class="form-label required">Adresse :</label>
                            <input type="text" class="form-control" id="marriageAddress" placeholder="Ex: 841 west Irving Boulevard">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label required">Ville :</label>
                            <input type="text" class="form-control" id="marriageCity" placeholder="Ex: Irving">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label required">Pays :</label>
                            <select class="form-select" id="marriageCountry">
                                <option value="">Sélectionnez...</option>
                                <option value="US">États-Unis (US)</option>
                                <option value="FR">France (FR)</option>
                                <option value="CI">Côte d'Ivoire (CI)</option>
                                <option value="CA">Canada (CA)</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label required">État :</label>
                            <input type="text" class="form-control" id="marriageState" placeholder="Ex: TX">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label required">Code Postal :</label>
                            <input type="text" class="form-control" id="marriageZipCode" placeholder="Ex: 75060">
                        </div>
                    </div>
                    
                    <!-- Adresse de Livraison -->
                    <h3 class="section-title"><i class="bi bi-truck me-2"></i>Adresse de Livraison</h3>
                    <div class="row">
                        <div class="col-12 mb-3">
                            <label class="form-label required">Adresse (rue) :</label>
                            <input type="text" class="form-control" id="deliveryAddress" placeholder="Ex: 4202 28th st#1">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label required">Ville :</label>
                            <input type="text" class="form-control" id="deliveryCity" placeholder="Ex: Mount Rainier">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label required">Pays :</label>
                            <select class="form-select" id="deliveryCountry">
                                <option value="">Sélectionnez...</option>
                                <option value="US">États-Unis (US)</option>
                                <option value="FR">France (FR)</option>
                                <option value="CI">Côte d'Ivoire (CI)</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label required">État :</label>
                            <input type="text" class="form-control" id="deliveryState" placeholder="Ex: MD">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label required">Code Postal :</label>
                                <input type="text" class="form-control" id="deliveryZipCode" placeholder="Ex: 20712">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label required">E-mail de livraison :</label>
                            <input type="email" class="form-control" id="deliveryEmail" placeholder="Ex: diabifamily360@gmail.com">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label required">Téléphone de livraison :</label>
                            <input type="tel" class="form-control" id="deliveryPhone" placeholder="Ex: 469-554-6744">
                        </div>
                    </div>
                    
                    <!-- Documents Section - HIDDEN FOR CNI (using view-only section above) -->
                    <div style="display:none;">
                    <h3 class="section-title"><i class="bi bi-folder me-2"></i>Documents OLD</h3>
                    <div class="row">
                        <div class="col-12 mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="certificateCopy">
                                <label class="form-check-label">
                                    Photocopie du Certificat de Mariage américain + traduction française certifiée
                                </label>
                            </div>
                        </div>
                        <div class="col-12 mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="transcriptCopy">
                                <label class="form-check-label">
                                    Copie de la demande de Transcription du Certificat de Mariage
                                </label>
                            </div>
                        </div>
                        <div class="col-12 mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="nationalityProof">
                                <label class="form-check-label">
                                    Preuve de nationalité d'un conjoint (CNI ou Certificat de Nationalité)
                                </label>
                            </div>
                        </div>
                        <div class="col-12 mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="idCopies">
                                <label class="form-check-label">
                                    Copie des Pièces d'identité des conjoints (CNI, Passeport ou attestation)
                                </label>
                            </div>
                        </div>
                        <div class="col-12 mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="consularCard">
                                <label class="form-check-label">
                                    Carte consulaire pour les résidents (si applicable)
                                </label>
                            </div>
                        </div>
                        <div class="col-12 mb-3">
                            <label class="form-label">Téléchargement du reçu :</label>
                            <input type="file" class="form-control" id="receiptUpload" accept=".pdf,.jpg,.png">
                            <small class="text-muted">Formats acceptés : PDF, JPG, PNG</small>
                        </div>
                    </div>
                    </div>
                </div>
                
                <!-- ============================================= -->
                <!-- PARTIE DROITE : VÉRIFICATION DONNÉES API -->
                <!-- ============================================= -->
                <div class="col-lg-6">
                    <div class="verification-header">
                        <h4><i class="bi bi-database-check me-2"></i>Vérification des Données</h4>
                        <p class="mb-0">Cliquez sur le bouton pour charger et comparer avec l'API</p>
                    </div>
                    
                    <!-- Section de chargement (affichée par défaut) -->
                    <div id="loadingSection" class="loading-section">
                        <div class="verification-icon">
                            <i class="bi bi-database"></i>
                        </div>
                        <h4 class="mb-3" style="color: #ff9800;">Données API non chargées</h4>
                        <p class="text-muted mb-4">Cliquez sur le bouton ci-dessous pour charger les données depuis l'API et comparer avec le formulaire</p>
                        
                        <!-- Bouton de vérification DÉPLACÉ ICI -->
                        <button class="btn verify-btn" onclick="loadAndVerifyApiData()">
                            <i class="bi bi-cloud-download me-2"></i> Charger et Vérifier les Données API
                        </button>
                    </div>
                    
                    <!-- Informations Personnelles API (caché par défaut) -->
                    <div id="apiPersonalInfo" class="verification-section">
                        <h3 class="section-title"><i class="bi bi-person-fill me-2"></i>Informations Personnelles (API)</h3>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Prénoms :</label>
                                <div class="api-data-field" id="apiFirstName"></div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nom de famille :</label>
                                <div class="api-data-field" id="apiLastName"></div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Sexe :</label>
                                <div class="api-data-field" id="apiGender"></div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Date de naissance :</label>
                                <div class="api-data-field" id="apiBirthDate"></div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Lieu de naissance :</label>
                                <div class="api-data-field" id="apiBirthPlace"></div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nationalité :</label>
                                <div class="api-data-field" id="apiNationality"></div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Situation matrimoniale :</label>
                                <div class="api-data-field" id="apiMaritalStatus"></div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Profession :</label>
                                <div class="api-data-field" id="apiProfession"></div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">N° NNI :</label>
                                <div class="api-data-field" id="apiNNI"></div>
                            </div>
                        </div>

                        <!-- Filiation API -->
                        <h5 class="mt-3 mb-3" style="color: #666;"><i class="bi bi-people me-2"></i>Filiation (API)</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nom du père :</label>
                                <div class="api-data-field" id="apiFatherLastName"></div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Prénoms du père :</label>
                                <div class="api-data-field" id="apiFatherFirstName"></div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nom de jeune fille de la mère :</label>
                                <div class="api-data-field" id="apiMotherMaidenName"></div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Prénoms de la mère :</label>
                                <div class="api-data-field" id="apiMotherFirstName"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Traitement et Livraison API (caché par défaut) -->
                    <div id="apiProcessingInfo" class="verification-section">
                        <h3 class="section-title"><i class="bi bi-speedometer2 me-2"></i>Traitement et Livraison (API)</h3>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Rapidité :</label>
                                <div class="api-data-field" id="apiProcessingSpeed"></div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Méthode de livraison :</label>
                                <div class="api-data-field" id="apiDeliveryMethod"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Époux(se) 1 API (caché par défaut) - HIDDEN FOR CNI -->
                    <div id="apiSpouse1Info" class="verification-section" style="display:none;">
                        <h4 class="section-title" style="color: #f57c00;"><i class="bi bi-person me-2"></i>Époux(se) 1 (API)</h4>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Prénom(s) :</label>
                                <div class="api-data-field" id="apiSpouse1FirstName"></div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nom :</label>
                                <div class="api-data-field" id="apiSpouse1LastName"></div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Date de Naissance :</label>
                                <div class="api-data-field" id="apiSpouse1BirthDate"></div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Pays de Naissance :</label>
                                <div class="api-data-field" id="apiSpouse1BirthCountry"></div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">État/Région :</label>
                                <div class="api-data-field" id="apiSpouse1State"></div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Profession :</label>
                                <div class="api-data-field" id="apiSpouse1Profession"></div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Adresse :</label>
                                <div class="api-data-field" id="apiSpouse1Address"></div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Ville :</label>
                                <div class="api-data-field" id="apiSpouse1City"></div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Code Postal :</label>
                                <div class="api-data-field" id="apiSpouse1ZipCode"></div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Téléphone :</label>
                                <div class="api-data-field" id="apiSpouse1Phone"></div>
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">E-mail :</label>
                                <div class="api-data-field" id="apiSpouse1Email"></div>
                            </div>
                        </div>
                        
                        <!-- Filiation Époux 1 API -->
                        <h5 class="mt-4 mb-3" style="color: #666;"><i class="bi bi-people me-2"></i>Filiation (API)</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nom du Père :</label>
                                <div class="api-data-field" id="apiSpouse1FatherName"></div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nom de la Mère :</label>
                                <div class="api-data-field" id="apiSpouse1MotherName"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Époux(se) 2 API (caché par défaut) - HIDDEN FOR CNI -->
                    <div id="apiSpouse2Info" class="verification-section" style="display:none;">
                        <h4 class="section-title" style="color: #f57c00;"><i class="bi bi-person me-2"></i>Époux(se) 2 (API)</h4>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Prénom(s) :</label>
                                <div class="api-data-field" id="apiSpouse2FirstName"></div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nom :</label>
                                <div class="api-data-field" id="apiSpouse2LastName"></div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Date de Naissance :</label>
                                <div class="api-data-field" id="apiSpouse2BirthDate"></div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Pays de Naissance :</label>
                                <div class="api-data-field" id="apiSpouse2BirthCountry"></div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">État/Région :</label>
                                <div class="api-data-field" id="apiSpouse2State"></div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Profession :</label>
                                <div class="api-data-field" id="apiSpouse2Profession"></div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Adresse :</label>
                                <div class="api-data-field" id="apiSpouse2Address"></div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Ville :</label>
                                <div class="api-data-field" id="apiSpouse2City"></div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Code Postal :</label>
                                <div class="api-data-field" id="apiSpouse2ZipCode"></div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Téléphone :</label>
                                <div class="api-data-field" id="apiSpouse2Phone"></div>
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">E-mail :</label>
                                <div class="api-data-field" id="apiSpouse2Email"></div>
                            </div>
                        </div>
                        
                        <!-- Filiation Époux 2 API -->
                        <h5 class="mt-4 mb-3" style="color: #666;"><i class="bi bi-people me-2"></i>Filiation (API)</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nom du Père :</label>
                                <div class="api-data-field" id="apiSpouse2FatherName"></div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nom de la Mère :</label>
                                <div class="api-data-field" id="apiSpouse2MotherName"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Lieu de Mariage API (caché par défaut) -->
                    <div id="apiMarriageInfo" class="verification-section">
                        <h3 class="section-title"><i class="bi bi-geo-alt me-2"></i>Lieu de Mariage (API)</h3>
                        <div class="row">
                            <div class="col-12 mb-3">
                                <label class="form-label">Adresse :</label>
                                <div class="api-data-field" id="apiMarriageAddress"></div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Ville :</label>
                                <div class="api-data-field" id="apiMarriageCity"></div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Pays :</label>
                                <div class="api-data-field" id="apiMarriageCountry"></div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">État :</label>
                                <div class="api-data-field" id="apiMarriageState"></div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Code Postal :</label>
                                <div class="api-data-field" id="apiMarriageZipCode"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Adresse de Livraison API (caché par défaut) -->
                    <div id="apiDeliveryInfo" class="verification-section">
                        <h3 class="section-title"><i class="bi bi-truck me-2"></i>Adresse de Livraison (API)</h3>
                        <div class="row">
                            <div class="col-12 mb-3">
                                <label class="form-label">Adresse (rue) :</label>
                                <div class="api-data-field" id="apiDeliveryAddress"></div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Ville :</label>
                                <div class="api-data-field" id="apiDeliveryCity"></div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Pays :</label>
                                <div class="api-data-field" id="apiDeliveryCountry"></div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">État :</label>
                                <div class="api-data-field" id="apiDeliveryState"></div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Code Postal :</label>
                                <div class="api-data-field" id="apiDeliveryZipCode"></div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">E-mail de livraison :</label>
                                <div class="api-data-field" id="apiDeliveryEmail"></div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Téléphone de livraison :</label>
                                <div class="api-data-field" id="apiDeliveryPhone"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Documents API (caché par défaut) - HIDDEN FOR CNI (using view-only section in left column) -->
                    <div id="apiDocumentsInfo" class="verification-section" style="display:none;">
                        <h3 class="section-title"><i class="bi bi-folder me-2"></i>Documents (API)</h3>
                        <div class="row">
                            <div class="col-12 mb-3">
                                <label class="form-label">Documents fournis :</label>
                                <div class="api-data-field" id="apiDocuments"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Boutons d'action opérateur - Centrés en bas -->
            <div id="actionButtons" class="row mt-5">
                <div class="col-12">
                    <div class="d-flex justify-content-center gap-3">
                        <button class="btn btn-success btn-approve" onclick="approveForm()" style="min-width: 200px;">
                            <i class="bi bi-check-circle me-2"></i>Approuver
                        </button>
                        <button class="btn btn-danger btn-refuse" onclick="refuseForm()" style="min-width: 200px;">
                            <i class="bi bi-x-circle me-2"></i>Refuser
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal - Document Viewer -->
    <div class="modal fade" id="documentViewerModal" tabindex="-1" aria-labelledby="documentViewerLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="documentViewerLabel">
                        <i class="bi bi-file-earmark-text me-2"></i> Visualisation de document
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <i class="bi bi-file-earmark-pdf text-primary" style="font-size: 4rem;"></i>
                    <p class="mt-3 mb-0">Fonctionnalité de visualisation de document en cours de développement.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">
                        <i class="bi bi-check-lg"></i> Fermer
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal - API Data Loaded -->
    <div class="modal fade" id="apiDataLoadedModal" tabindex="-1" aria-labelledby="apiDataLoadedLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header" style="background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%); color: white;">
                    <h5 class="modal-title" id="apiDataLoadedLabel">
                        <i class="bi bi-check-circle me-2"></i> Données chargées
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <i class="bi bi-check-circle-fill text-success" style="font-size: 5rem;"></i>
                    <h4 class="mt-3 mb-3">Données API chargées avec succès !</h4>
                    <p class="mb-0">Les informations ont été comparées avec le formulaire.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" data-bs-dismiss="modal">
                        <i class="bi bi-check-lg"></i> Continuer
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal - Differences Detected -->
    <div class="modal fade" id="differencesDetectedModal" tabindex="-1" aria-labelledby="differencesDetectedLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title" id="differencesDetectedLabel">
                        <i class="bi bi-exclamation-triangle me-2"></i> Différences détectées
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <i class="bi bi-exclamation-triangle text-warning" style="font-size: 4rem;"></i>
                    <h4 class="mt-3 mb-3"><span id="differencesCount">0</span> différence(s) détectée(s) avec l'API</h4>
                    <p class="mb-0">Veuillez vérifier les champs surlignés en orange.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-warning" data-bs-dismiss="modal">
                        <i class="bi bi-check-lg"></i> Compris
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal - Perfect Match -->
    <div class="modal fade" id="perfectMatchModal" tabindex="-1" aria-labelledby="perfectMatchLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header" style="background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%); color: white;">
                    <h5 class="modal-title" id="perfectMatchLabel">
                        <i class="bi bi-check-circle me-2"></i> Correspondance parfaite
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <i class="bi bi-check-circle-fill text-success" style="font-size: 5rem;"></i>
                    <h4 class="mt-3 mb-3">Toutes les données correspondent parfaitement avec l'API !</h4>
                    <p class="mb-0">Aucune différence détectée.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" data-bs-dismiss="modal">
                        <i class="bi bi-check-lg"></i> Continuer
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal - Approval Success -->
    <div class="modal fade" id="approvalSuccessModal" tabindex="-1" aria-labelledby="approvalSuccessLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header" style="background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%); color: white;">
                    <h5 class="modal-title" id="approvalSuccessLabel">
                        <i class="bi bi-check-circle me-2"></i> Formulaire approuvé
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <i class="bi bi-check-circle-fill text-success" style="font-size: 5rem;"></i>
                    <h4 class="mt-3 mb-3">Formulaire approuvé avec succès !</h4>
                    <p class="mb-0">Le dossier a été validé et transmis au traitement.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" data-bs-dismiss="modal" id="approvalSuccessBtn">
                        <i class="bi bi-check-lg"></i> Continuer
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal - Refusal Confirmation -->
    <div class="modal fade" id="refusalConfirmationModal" tabindex="-1" aria-labelledby="refusalConfirmationLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="refusalConfirmationLabel">
                        <i class="bi bi-x-circle me-2"></i> Formulaire refusé
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <i class="bi bi-x-circle-fill text-danger" style="font-size: 5rem;"></i>
                    <h4 class="mt-3 mb-3">Formulaire refusé</h4>
                    <p class="mb-2"><strong>Raison :</strong></p>
                    <p class="mb-0" id="refusalReasonText"></p>
                    <p class="mt-3 mb-0">Le demandeur sera notifié.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal" id="refusalConfirmationBtn">
                        <i class="bi bi-check-lg"></i> Continuer
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Document Requirements Script -->
    <script src="documentRequirements.js"></script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Read URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const applicationType = urlParams.get('type'); // e.g., 'nouvelle-demande'
        const applicationId = urlParams.get('id');

        // Sub-service titles
        const subserviceTitles = {
            'nouvelle-demande': 'Nouvelle Demande CNI',
            'renouvellement': 'Renouvellement CNI',
            'modifications': 'Modifications CNI',
            'duplicata': 'Duplicata CNI',
            'demande-nni': 'Demande de NNI'
        };

        // Update page title based on application type
        if (applicationType && subserviceTitles[applicationType]) {
            document.getElementById('formTitle').innerHTML =
                `<i class="bi bi-clipboard-data me-2"></i>${subserviceTitles[applicationType]}`;
        }

        // Initialize modals
        const documentViewerModal = new bootstrap.Modal(document.getElementById('documentViewerModal'));
        const apiDataLoadedModal = new bootstrap.Modal(document.getElementById('apiDataLoadedModal'));
        const differencesDetectedModal = new bootstrap.Modal(document.getElementById('differencesDetectedModal'));
        const perfectMatchModal = new bootstrap.Modal(document.getElementById('perfectMatchModal'));
        const approvalSuccessModal = new bootstrap.Modal(document.getElementById('approvalSuccessModal'));
        const refusalConfirmationModal = new bootstrap.Modal(document.getElementById('refusalConfirmationModal'));

        // Function to show document viewer modal
        function showDocumentViewer() {
            documentViewerModal.show();
        }

        // Initialiser les champs avec des valeurs par défaut (optionnel)
        document.addEventListener('DOMContentLoaded', function() {
            // Load dynamic form based on application type
            if (applicationType) {
                loadDynamicForm(applicationType, applicationId);
            } else {
                // Default to marriage transcript form if no type specified
                document.getElementById('serviceType').value = 'Civil Documents';
                document.getElementById('additionalService').value = 'Marriage Transcript';
                document.getElementById('maritalRegime').value = 'Joint Goods';
            }
        });

        // Function to go back to filtered list
        function goBackToList() {
            if (applicationType) {
                window.location.href = `listeciviloperateur.html?subservice=${applicationType}`;
            } else {
                window.location.href = 'listeciviloperateur.html';
            }
        }

        // Function to load dynamic form based on application type
        function loadDynamicForm(type, id) {
            console.log('Loading form for type:', type, 'id:', id);

            // Check if type requires case selection (nouvelle-demande)
            if (type === 'nouvelle-demande') {
                loadNouvelleDemandeCNI(id);
            } else if (type === 'renouvellement') {
                loadRenouvellementCNI(id);
            } else if (type === 'modifications') {
                loadModificationsCNI(id);
            } else if (type === 'duplicata') {
                loadDuplicataCNI(id);
            } else if (type === 'demande-nni') {
                loadDemandeNNI(id);
            }
        }

        // Load Nouvelle Demande CNI form
        function loadNouvelleDemandeCNI(id) {
            const leftColumn = document.querySelector('.col-lg-6:first-child');

            leftColumn.innerHTML = `
                <div class="verification-header">
                    <h4><i class="bi bi-file-earmark-plus me-2"></i>Nouvelle Demande CNI</h4>
                    <p class="mb-0">ID: ${id}</p>
                </div>

                <!-- Case Type Selector -->
                <div class="mb-4">
                    <label class="form-label fw-bold">Type de demande:</label>
                    <select class="form-select" id="caseTypeSelector" onchange="handleCaseTypeChange()">
                        <option value="">Sélectionnez le cas...</option>
                        <option value="case-a">Cas A - Né(e) en Côte d'Ivoire</option>
                        <option value="case-b">Cas B - Né(e) hors Côte d'Ivoire</option>
                        <option value="case-c">Cas C - Naturalisation</option>
                        <option value="case-d">Cas D - Acquisition par mariage</option>
                    </select>
                </div>

                <!-- Applicant Information -->
                <h3 class="section-title"><i class="bi bi-person me-2"></i>Informations du demandeur</h3>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Nom:</label>
                        <input type="text" class="form-control" value="Kouamé" readonly>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Prénom:</label>
                        <input type="text" class="form-control" value="Jean" readonly>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Date de naissance:</label>
                        <input type="date" class="form-control" value="1990-05-15" readonly>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Lieu de naissance:</label>
                        <input type="text" class="form-control" value="Abidjan, Côte d'Ivoire" readonly>
                    </div>
                </div>

                <!-- Documents Checklist Container -->
                <div id="documentsContainer" class="mt-4"></div>
            `;

            // Trigger case type change to load default documents
            document.getElementById('caseTypeSelector').value = 'case-a';
            handleCaseTypeChange();
        }

        // Load Renouvellement CNI form
        function loadRenouvellementCNI(id) {
            const leftColumn = document.querySelector('.col-lg-6:first-child');

            leftColumn.innerHTML = `
                <div class="verification-header">
                    <h4><i class="bi bi-arrow-clockwise me-2"></i>Renouvellement CNI</h4>
                    <p class="mb-0">ID: ${id}</p>
                </div>

                <!-- Applicant Information -->
                <h3 class="section-title"><i class="bi bi-person me-2"></i>Informations du demandeur</h3>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Nom:</label>
                        <input type="text" class="form-control" value="Achi" readonly>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Prénom:</label>
                        <input type="text" class="form-control" value="Danielle" readonly>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Numéro CNI actuel:</label>
                        <input type="text" class="form-control" value="CNI-2019-123456" readonly>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Date d'expiration:</label>
                        <input type="date" class="form-control" value="2024-01-15" readonly>
                    </div>
                </div>

                <!-- Documents Checklist -->
                <h3 class="section-title"><i class="bi bi-folder2-open me-2"></i>Documents requis</h3>
                <div id="documentsContainer"></div>
            `;

            // Load renouvellement documents
            const documentsHtml = renderDocumentChecklist('cni', 'renouvellement');
            document.getElementById('documentsContainer').innerHTML = documentsHtml;
        }

        // Load Modifications CNI form
        function loadModificationsCNI(id) {
            const leftColumn = document.querySelector('.col-lg-6:first-child');

            leftColumn.innerHTML = `
                <div class="verification-header">
                    <h4><i class="bi bi-pencil-square me-2"></i>Modifications CNI</h4>
                    <p class="mb-0">ID: ${id}</p>
                </div>

                <!-- Applicant Information -->
                <h3 class="section-title"><i class="bi bi-person me-2"></i>Informations du demandeur</h3>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Nom actuel:</label>
                        <input type="text" class="form-control" value="Diallo" readonly>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Prénom:</label>
                        <input type="text" class="form-control" value="Mamadou" readonly>
                    </div>
                    <div class="col-12 mb-3">
                        <label class="form-label">Type de modification demandée:</label>
                        <input type="text" class="form-control" value="Correction d'orthographe du nom" readonly>
                    </div>
                </div>

                <!-- Image Reference for Modifications -->
                <div class="alert alert-info">
                    <h5><i class="bi bi-images me-2"></i>Documents requis</h5>
                    <p>Référez-vous aux images dans le dossier: <code>../assets/cni-modification/</code></p>
                    <p class="mb-0">Les documents requis varient selon le type de modification demandée.</p>
                </div>
            `;
        }

        // Load Duplicata CNI form
        function loadDuplicataCNI(id) {
            const leftColumn = document.querySelector('.col-lg-6:first-child');

            leftColumn.innerHTML = `
                <div class="verification-header">
                    <h4><i class="bi bi-files me-2"></i>Duplicata CNI</h4>
                    <p class="mb-0">ID: ${id}</p>
                </div>

                <!-- Applicant Information -->
                <h3 class="section-title"><i class="bi bi-person me-2"></i>Informations du demandeur</h3>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Nom:</label>
                        <input type="text" class="form-control" value="Traoré" readonly>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Prénom:</label>
                        <input type="text" class="form-control" value="Fatou" readonly>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Numéro CNI perdue:</label>
                        <input type="text" class="form-control" value="CNI-2021-789012" readonly>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Date de perte:</label>
                        <input type="date" class="form-control" value="2025-12-01" readonly>
                    </div>
                </div>

                <!-- Documents Checklist -->
                <h3 class="section-title"><i class="bi bi-folder2-open me-2"></i>Documents requis</h3>
                <div id="documentsContainer"></div>
            `;

            // Load duplicata documents
            const documentsHtml = renderDocumentChecklist('cni', 'duplicata');
            document.getElementById('documentsContainer').innerHTML = documentsHtml;
        }

        // Load Demande NNI form
        function loadDemandeNNI(id) {
            const leftColumn = document.querySelector('.col-lg-6:first-child');

            leftColumn.innerHTML = `
                <div class="verification-header">
                    <h4><i class="bi bi-person-vcard me-2"></i>Demande de NNI</h4>
                    <p class="mb-0">ID: ${id}</p>
                </div>

                <!-- Applicant Information -->
                <h3 class="section-title"><i class="bi bi-person me-2"></i>Informations du demandeur</h3>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Nom:</label>
                        <input type="text" class="form-control" value="Konan" readonly>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Prénom:</label>
                        <input type="text" class="form-control" value="Paul" readonly>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Date de naissance:</label>
                        <input type="date" class="form-control" value="1995-08-20" readonly>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Lieu de naissance:</label>
                        <input type="text" class="form-control" value="Yamoussoukro" readonly>
                    </div>
                </div>

                <!-- Image Reference for NNI -->
                <div class="alert alert-info">
                    <h5><i class="bi bi-images me-2"></i>Documents requis</h5>
                    <p>Référez-vous aux images dans le dossier: <code>../assets/cni-demande-de-nni/</code></p>
                    <p class="mb-0">Les documents requis sont détaillés dans les images de référence.</p>
                </div>
            `;
        }

        // Handle case type change for nouvelle-demande
        function handleCaseTypeChange() {
            const caseType = document.getElementById('caseTypeSelector')?.value;
            const documentsContainer = document.getElementById('documentsContainer');

            if (!caseType || !documentsContainer) return;

            // Load documents for selected case type
            documentsContainer.innerHTML = `
                <h3 class="section-title"><i class="bi bi-folder2-open me-2"></i>Documents requis</h3>
                ${renderDocumentChecklist('cni', 'nouvelle-demande', caseType)}
            `;
        }

        // Fonction pour charger et vérifier les données API
        function loadAndVerifyApiData() {
            // Afficher l'animation de chargement
            const loadingSection = document.getElementById('loadingSection');
            loadingSection.innerHTML = `
                <div class="loading-spinner"></div>
                <h4 class="mb-3" style="color: #ff9800;">Chargement des données API...</h4>
                <p class="text-muted">Veuillez patienter pendant que nous récupérons les données depuis le serveur</p>
            `;
            
            // Simuler un délai de chargement API (2 secondes)
            setTimeout(() => {
                // Cacher la section de chargement
                loadingSection.style.display = 'none';
                
                // Charger les données API simulées
                loadApiData();
                
                // Afficher toutes les sections API
                showAllApiSections();
                
                // Comparer les données
                compareDataWithApi();
                
                // Afficher les boutons d'action
                document.getElementById('actionButtons').style.display = 'flex';
                
                // Afficher un message de succès
                apiDataLoadedModal.show();
                
            }, 2000);
        }
        
        // Fonction pour afficher toutes les sections API
        function showAllApiSections() {
            const apiSections = [
                'apiPersonalInfo',
                'apiProcessingInfo'
            ];

            apiSections.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.style.display = 'block';
                }
            });
        }
        
        // Fonction pour charger les données API (simulées pour l'exemple)
        function loadApiData() {
            // Données simulées de l'API - CNI
            const apiData = {
                // Informations personnelles
                firstName: 'Jean-Baptiste',
                lastName: 'KOUAME',
                gender: 'M',
                birthDate: '1990-05-15',
                birthPlace: 'Abidjan',
                nationality: 'Ivoirienne',
                maritalStatus: 'Célibataire',
                profession: 'Ingénieur Informatique',
                nni: '12345678901',

                // Filiation
                fatherLastName: 'KOUAME',
                fatherFirstName: 'Pierre',
                motherMaidenName: 'BAMBA',
                motherFirstName: 'Marie',

                // Traitement et livraison
                processingSpeed: 'Normal (7 jours)',
                deliveryMethod: 'Retrait sur place'
            };
            
            // Mettre à jour les champs API - CNI
            document.getElementById('apiFirstName').textContent = apiData.firstName;
            document.getElementById('apiLastName').textContent = apiData.lastName;
            document.getElementById('apiGender').textContent = apiData.gender === 'M' ? 'Masculin' : 'Féminin';
            document.getElementById('apiBirthDate').textContent = apiData.birthDate;
            document.getElementById('apiBirthPlace').textContent = apiData.birthPlace;
            document.getElementById('apiNationality').textContent = apiData.nationality;
            document.getElementById('apiMaritalStatus').textContent = apiData.maritalStatus;
            document.getElementById('apiProfession').textContent = apiData.profession;
            document.getElementById('apiNNI').textContent = apiData.nni;

            // Filiation
            document.getElementById('apiFatherLastName').textContent = apiData.fatherLastName;
            document.getElementById('apiFatherFirstName').textContent = apiData.fatherFirstName;
            document.getElementById('apiMotherMaidenName').textContent = apiData.motherMaidenName;
            document.getElementById('apiMotherFirstName').textContent = apiData.motherFirstName;

            // Traitement et livraison
            document.getElementById('apiProcessingSpeed').textContent = apiData.processingSpeed;
            document.getElementById('apiDeliveryMethod').textContent = apiData.deliveryMethod;
        }
        
        // Comparer les données utilisateur avec les données API
        function compareDataWithApi() {
            const differences = [];
            const matches = [];

            // Liste des champs à comparer - CNI
            const fieldsToCompare = [
                { user: 'firstName', api: 'apiFirstName', label: 'Prénoms' },
                { user: 'lastName', api: 'apiLastName', label: 'Nom' },
                { user: 'birthDate', api: 'apiBirthDate', label: 'Date de naissance' },
                { user: 'birthPlace', api: 'apiBirthPlace', label: 'Lieu de naissance' },
                { user: 'profession', api: 'apiProfession', label: 'Profession' },
                { user: 'nni', api: 'apiNNI', label: 'NNI' }
            ];
            
            fieldsToCompare.forEach(field => {
                const userValue = document.getElementById(field.user).value;
                const apiValue = document.getElementById(field.api).textContent;
                
                if (userValue === apiValue) {
                    matches.push(field.label);
                    // Style vert pour correspondance
                    document.getElementById(field.user).style.borderColor = '#4caf50';
                    document.getElementById(field.user).style.backgroundColor = '#d4edda';
                    document.getElementById(field.api).style.borderColor = '#4caf50';
                    document.getElementById(field.api).style.backgroundColor = '#d4edda';
                } else {
                    differences.push(`${field.label}: "${userValue}" vs "${apiValue}"`);
                    // Style orange pour différence
                    document.getElementById(field.user).style.borderColor = '#ff9800';
                    document.getElementById(field.user).style.backgroundColor = '#fff3cd';
                    document.getElementById(field.api).style.borderColor = '#ff9800';
                    document.getElementById(field.api).style.backgroundColor = '#fff3cd';
                }
            });
            
            // Afficher un résumé
            console.log('Correspondances:', matches);
            console.log('Différences:', differences);
            
            if (differences.length > 0) {
                document.getElementById('differencesCount').textContent = differences.length;
                differencesDetectedModal.show();
            } else {
                perfectMatchModal.show();
            }
        }
        
        // Fonction pour approuver le formulaire
        function approveForm() {
            if (confirm('Êtes-vous sûr de vouloir approuver ce formulaire ?')) {
                // Simulation d'approbation
                approvalSuccessModal.show();

                // Redirect to filtered datatable after modal is dismissed
                document.getElementById('approvalSuccessBtn').addEventListener('click', function() {
                    if (applicationType) {
                        window.location.href = `listeciviloperateur.html?subservice=${applicationType}`;
                    } else {
                        window.location.href = 'listeciviloperateur.html';
                    }
                }, { once: true });
            }
        }

        // Fonction pour refuser le formulaire
        function refuseForm() {
            const reason = prompt('Veuillez indiquer la raison du refus :');

            if (reason) {
                if (confirm(`Refuser ce formulaire avec la raison : "${reason}" ?`)) {
                    // Simulation de refus
                    document.getElementById('refusalReasonText').textContent = reason;
                    refusalConfirmationModal.show();

                    // Redirect to filtered datatable after modal is dismissed
                    document.getElementById('refusalConfirmationBtn').addEventListener('click', function() {
                        if (applicationType) {
                            window.location.href = `listeciviloperateur.html?subservice=${applicationType}`;
                        } else {
                            window.location.href = 'listeciviloperateur.html';
                        }
                    }, { once: true });
                }
            }
        }
        
        // Fonction pour le bouton retour
        function goBack() {
            if (confirm('Voulez-vous vraiment quitter cette page ? Les modifications non enregistrées seront perdues.')) {
                // Simuler un retour en arrière
                window.location.href = 'javascript:history.back()';
            }
        }
    </script>
</body>
</html>